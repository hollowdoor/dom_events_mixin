{"version":3,"file":"dom-events-mixin.min.js","sources":["../src/lib/keyfrom.js","../src/lib/event_registry.js","../src/index.js","../node_modules/matches-selector/index.js","../src/lib/keynames.js"],"sourcesContent":["import keynames from './keynames.js';\n\nexport default function keyFrom(event){\n\n    return (keynames[event.which]\n        || String.fromCharCode(event.keyCode).toLowerCase());\n}\n","import matches from 'matches-selector';\nimport keyFrom from './keyfrom.js';\n\nexport function registerEvent(source, name){\n    source._events = source._events || {};\n    source._events[name] = source._events[name] || [];\n}\n\nfunction initInfo(name){\n    const info = {keys: null, name};\n    let keys, names;\n    let maybeKeys = name.split(':').map(s=>s.trim());\n    if(maybeKeys.length > 1){\n        let map = {}, index;\n        [keys, names] = maybeKeys;\n        let list = keys.split(' ');\n        const setOp = (name)=>{\n            if((index = list.indexOf(name)) !== -1){\n                map[name] = true;\n                map.operators = true;\n                list.splice(index, 1);\n            }\n\n        };\n        setOp('ctrl');\n        setOp('alt');\n        setOp('shift');\n        map.key = list[0];\n        info.keys = map;\n        info.names = names.split(' ');\n    }else{\n        info.names = name.split(' ');\n    }\n\n    return info;\n}\n\nexport function getEventInfo(name, delegate, listener, useCapture, once){\n\n    let userListener = listener;\n    let source = this;\n    let info = initInfo(name);\n\n    if(typeof delegate !== 'string'){\n        useCapture = listener;\n        listener = delegate;\n        delegate = null;\n    }\n\n    //Last caller is created first\n    //All layered like an onion from the inside out on creation\n    //Pealed from the outside in on event firing\n    if(once){\n        listener = ((fire)=>{\n            return function(event){\n                removeEvent(source, info);\n                return fire.call(this, event);\n            };\n        })(listener);\n    }\n\n    if(typeof delegate === 'string'){\n        listener = ((fire)=>{\n            return function(event){\n                if(matches(event.target, delegate)){\n                    return fire.call(this, event);\n                }\n            };\n        })(listener);\n    }\n\n    if(info.keys){\n        listener = ((fire)=>{\n            const map = info.keys;\n            return function(event){\n\n                if(!map.key || map.key === keyFrom(event)){\n                    if((event.ctrlKey || undefined) == map.ctrl &&\n                    (event.altKey || undefined) == map.alt &&\n                    (event.shiftKey || undefined) == map.shift){\n                        return fire.call(this, event);\n                    }\n                }\n            };\n        })(listener);\n    }\n\n    return Object.assign(info, {\n        listener,\n        userListener,\n        useCapture,\n        delegate\n    });\n}\n\nexport function addEvent(source, event){\n    source._events[event.name].push(event);\n    event.names.forEach(name=>{\n        source.element.addEventListener(name, event.listener, event.useCapture);\n    });\n}\n\nexport function removeEvent(source, event){\n    if(source._events === void 0) return;\n    if(source._events[event.name] === void 0) return;\n\n    let events = source._events[event.name];\n\n    for(let i=0; i<events.length; i++){\n        if(events[i].userListener === event.userListener){\n            events[i].names.forEach(name=>{\n                source.element.removeEventListener(\n                    name, event.listener, event.useCapture);\n            });\n            \n            source._events[event.name].splice(i, 1);\n            if(!source._events[event.name].length){\n                delete source._events[event.name];\n            }\n            return;\n        }\n    }\n}\n","import {\n    getEventInfo,\n    registerEvent,\n    addEvent,\n    removeEvent\n} from './lib/event_registry.js';\n\nconst props = {\n    _delegated: [],\n    on(name, delegate, listener, useCapture){\n        const info = getEventInfo.apply(null, arguments);\n        registerEvent(this, name);\n        addEvent(this, info);\n    },\n    off(name, delegate, listener, useCapture){\n        const info = getEventInfo.apply(null, arguments);\n        removeEvent(this, info);\n    },\n    once(name, delegate, listener, useCapture){\n        const info = getEventInfo.call(this, name, delegate, listener, useCapture, true);\n        registerEvent(this, name);\n        addEvent(this, info);\n    },\n    matches(selector){\n        return matches(this.element, selector);\n    },/*\n    key(keys, listener){\n        return keyed(this, keys, listener);\n    }*/\n};\n\nexport function mixin(dest){\n    Object.assign(dest, props);\n    return dest;\n}\n\nexport function mixinDOMEvents(dest){\n    return mixin(dest);\n}\n\nexport { props };\n\nfunction hasDelegate(args){\n    return (typeof args[1] === 'string'\n    && typeof args[2] === 'function');\n}\n","'use strict';\n\nvar proto = typeof Element !== 'undefined' ? Element.prototype : {};\nvar vendor = proto.matches\n  || proto.matchesSelector\n  || proto.webkitMatchesSelector\n  || proto.mozMatchesSelector\n  || proto.msMatchesSelector\n  || proto.oMatchesSelector;\n\nmodule.exports = match;\n\n/**\n * Match `el` to `selector`.\n *\n * @param {Element} el\n * @param {String} selector\n * @return {Boolean}\n * @api public\n */\n\nfunction match(el, selector) {\n  if (!el || el.nodeType !== 1) return false;\n  if (vendor) return vendor.call(el, selector);\n  var nodes = el.parentNode.querySelectorAll(selector);\n  for (var i = 0; i < nodes.length; i++) {\n    if (nodes[i] == el) return true;\n  }\n  return false;\n}\n","const keynames = {\n  8   : 'backspace',\n  9   : 'tab',\n  13  : 'enter',\n  16  : 'shift',\n  17  : 'ctrl',\n  18  : 'alt',\n  20  : 'capslock',\n  27  : 'esc',\n  32  : 'space',\n  33  : 'pageup',\n  34  : 'pagedown',\n  35  : 'end',\n  36  : 'home',\n  37  : 'left',\n  38  : 'up',\n  39  : 'right',\n  40  : 'down',\n  45  : 'ins',\n  46  : 'del',\n  91  : 'meta',\n  93  : 'meta',\n  224 : 'meta'\n};\n\nexport default keynames;\n"],"names":["keyFrom","event","keynames","which","String","fromCharCode","keyCode","toLowerCase","registerEvent","source","name","_events","initInfo","const","keys","names","info","maybeKeys","split","map","s","trim","length","let","index","list","setOp","indexOf","operators","splice","key","getEventInfo","delegate","listener","useCapture","once","userListener","this","fire","removeEvent","call","matches","target","ctrlKey","undefined","ctrl","altKey","alt","shiftKey","shift","Object","assign","addEvent","push","forEach","element","addEventListener","events","i","removeEventListener","mixin","dest","props","proto","Element","prototype","vendor","matchesSelector","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","el","selector","nodeType","nodes","parentNode","querySelectorAll","8","9","13","16","17","18","20","27","32","33","34","35","36","37","38","39","40","45","46","91","93","224","_delegated","on","apply","arguments","off"],"mappings":"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"}